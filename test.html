<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>Performance test</title>

  <!-- include source files here... -->
  <script type="text/javascript" src="src/packages.js"></script>
  <script type="text/javascript" src="src/baredom/core/ReadOnlyDom.js"></script>
  <script type="text/javascript" src="src/baredom/core/Dom.js"></script>
  <script type="text/javascript" src="src/baredom/core/ObservableDom.js"></script>
  <script type="text/javascript" src="src/baredom/impl/QName.js"></script>
  <script type="text/javascript" src="src/baredom/impl/Dom.js"></script>
  <script type="text/javascript" src="src/baredom/impl/EventProxy.js"></script>
  <script type="text/javascript" src="src/baredom/impl/DomBridge.js"></script>
  <script type="text/javascript" src="src/baredom/impl/w3c/NodeList.js"></script>
  <script type="text/javascript" src="src/baredom/impl/w3c/Node.js"></script>
  <script type="text/javascript" src="src/baredom/impl/w3c/Attr.js"></script>
  <script type="text/javascript" src="src/baredom/impl/w3c/Document.js"></script>
  <script type="text/javascript" src="src/baredom/impl/w3c/Element.js"></script>
  <script type="text/javascript">

function addRandomTexts(bridge) {
    var vdom = bridge.getVirtualDom(),
        qname = vdom.getQNames().getQName(document.body.namespaceURI, "div"),
        nodes = [],
        n = 0,
        interval;
    function changeTexts() {
        var i;
        for (i = 0; i < 1000; i += 1) {
            j = Math.floor(Math.random() * 1000);
            if (nodes[j]) {
                vdom.removeNode(nodes[j]);
            }
            if (j % 5) {
                nodes[j] = vdom.insertText(Math.random() + " ", vdom.getDocumentElement(), 0);
            } else {
                nodes[j] = vdom.insertElement(qname, vdom.getDocumentElement(), 0);
            }
        }
        n += 1;
        if (n > 1000) {
            window.clearInterval(interval);
        }
    }
    interval = window.setInterval(changeTexts, 0);
    window.setInterval(function () {
        bridge.render();
    }, 40);
}
function initVDom(vdom) {
    var qname = vdom.getQNames().getQName(document.body.namespaceURI, "span"),
        span1 = vdom.insertElement(qname, vdom.getDocumentElement(), 0),
        span2 = vdom.insertElement(qname, span1, 0),
        text = vdom.insertText("HELLO", span2, 0);
    vdom.addEventListener(span1, "click", function (e) {
        console.log("span1 " + e.target);
        console.log(e);
    });
    vdom.addEventListener(span2, "click", function (e) {
        console.log("span2 " + e.target);
        console.log(e);
    });
}
function textTest() {
    var text = document.createTextNode("click me!"),
        div1 = document.createElement("div"),
        div2 = document.createElement("div");
    document.body.appendChild(div1);
    div1.appendChild(div2);
    div2.appendChild(text);
    text.addEventListener("click", function (e) {
        console.log(e.target);
    });
    div1.addEventListener("click", function (e) {
        console.log(e);
    });
}
function init() {
//    textTest();
    var qnames = new baredom.impl.QName(),
        qname = qnames.getQName(document.body.namespaceURI, "div"),
        vdom = new baredom.impl.Dom(qnames, qname),
        div = document.createElementNS(document.body.namespaceURI, "div"),
        bridge = new baredom.impl.DomBridge(vdom, div);
    initVDom(vdom);
    bridge.render();
    document.body.appendChild(div);
    addRandomTexts(bridge);
}
  </script>
</head>
<body onload="init()">
</body>
</html>
